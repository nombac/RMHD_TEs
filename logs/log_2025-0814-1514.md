# IDL から Python への変換作業ログ
**日時:** 2025年8月14日 15:14  
**作業ディレクトリ:** `/Users/shirose/Library/CloudStorage/Dropbox/DIM50th/zeus_rad/idl`

## 概要
IDLで書かれた `s_curve_all.pro` とその依存ファイルをPythonに変換する作業を実施。

## 作業内容

### 1. s_curve_all.pro の依存関係調査
- **メインファイル:** `s_curve_all.pro`
- **依存ファイル:**
  - `targ_hirose2015.pro` - シミュレーション結果のターゲット定義
  - `ZEUS_PARAM` プロシージャ - パラメータ読み込み
  - `READU` 関数 - バイナリデータ読み込み
- **外部ライブラリ:**
  - Coyote Graphics (`CGPLOT`, `CGOPLOT`)
  - PostScript関連 (`PS_OPEN`, `PS_CLOSE`)
  - IDL標準ライブラリ (`TEXTOIDL`)

### 2. READU関数のPython実装
**作成ファイル:** `readu.py`

#### 主な機能
- 1D、2D、3D配列の読み込みに対応
- ビッグエンディアンがデフォルト（IDLと同じ）
- 最初の4バイトをスキップ（IDLの`data_start=4`に対応）
- float32形式でデータを読み込み
- エラーハンドリング実装

#### 読み込むファイル
- `vave.data` - シミュレーション結果の時系列データ（2次元配列）
- `resolv.data` - 次元情報（n_t, n_vave）を含むテキストファイル

#### テスト結果
- `test/h/vave.data` の読み込みに成功

### 3. ZEUS_PARAM プロシージャのPython実装
**作成ファイル:** `zeus_param.py`

#### 主な機能
- Zeusシミュレーションのパラメータを各種設定ファイルから読み込み
- `spawnx` 関数も内部実装（シェルコマンド実行用）

#### 読み込むファイル
1. **Makefile** (`{homepath}/src/Makefile`)
   - 問題タイプの判定（isothermal/radiation/okuzumi/adiabatic）

2. **パラメータファイル** (いずれか1つ)
   - `{homepath}/init/iparax.data`
   - `{homepath}/init/normalize.data`
   - `{homepath}/init/ipara.data`
   - omega（角周波数）とh0（スケールハイト）を取得

3. **入力設定ファイル** (`{homepath}/z3dinput`)
   - `gascon` 行: gamma（断熱指数）、mmw（平均分子量）
   - `sanocon` 行: 特殊ケースのgamma値
   - `ggen1/2/3` 行: ボックスサイズ（lx, ly, lz）

#### 返り値
- `omega` - 角周波数
- `h0` - スケールハイト
- `gamma` - 断熱指数
- `mmw` - 平均分子量
- `isoth` - 等温フラグ
- `torb` - 軌道周期
- `lx, ly, lz` - ボックス寸法

### 4. 表面密度（sigma）の計算
`s_curve_all.pro` での計算方法：
```idl
sigma = a[*,3-1] * lz  ; vave.dataの3列目 × ボックスのz方向サイズ
```

Pythonでの実装：
```python
sigma_array = data[:, 2] * lz  # Pythonは0始まりなので列2
```

### 5. テスト環境
`test/` ディレクトリ構造：
```
test/
├── src/
│   └── Makefile
├── init/
│   └── (オプション: iparax.data, normalize.data, ipara.data)
├── h/
│   ├── vave.data
│   └── resolv.data
└── z3dinput
```

## 作成ファイル一覧
1. `readu.py` - IDLのREADU関数のPython実装
2. `zeus_param.py` - ZEUS_PARAMプロシージャのPython実装

## 残作業
1. `targ_hirose2015.pro` の読み込み機能実装
2. `s_curve_all.pro` の完全なPython版作成
3. プロット機能（matplotlib）の実装
4. PostScript出力の代替実装

## 次回の再開方法
```bash
cd /Users/shirose/Library/CloudStorage/Dropbox/DIM50th/zeus_rad/idl
# 作成済みファイルの確認
ls *.py
# readu.py と zeus_param.py が存在することを確認
```

「s_curve_all.proのPython変換の続き」と伝えれば、この作業の続きから開始可能。