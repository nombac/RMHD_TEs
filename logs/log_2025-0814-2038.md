# TE_curves GitHubリポジトリ構築作業ログ
**日時:** 2025年8月14日 20:38  
**作業ディレクトリ:** `/Users/shirose/Library/CloudStorage/Dropbox/DIM50th/zeus_rad/idl`

## 概要
IDLで書かれた `s_curve_all.pro` のPython実装を完成させ、matplotlibベースのプロット機能を追加。GitHubリポジトリ「TE_curves」として公開準備を実施。

## 作業内容

### 1. CLAUDE.md の作成と更新
- ZEUSシミュレーションコードベースのドキュメント作成
- 日本語での対話設定を追加
- 作業ログ参照の指示を追加

### 2. target_config.py の完全実装
**元ファイル:** `targ_hirose2015.pro`

#### 追加されたターゲット
- h2006, h2007: 特別ケース（ハードコード値）
- h2009シリーズ: 9エントリ（γ=5/3）
- h2011シリーズ: 1エントリ（γ=1.4）  
- h2014シリーズ: 23エントリ（upper/middle/lower branch）
- h2015シリーズ: 26エントリ
- h2016シリーズ: 7エントリ（自己重力含む）
- 合計: 66ターゲット + dummyエントリ

### 3. s_curve_all.py の完全実装とプロット機能追加
**実装した機能:**

#### データ処理部分
- 特別ケース（h2006, h2007）のハードコード処理
- シミュレーションデータの読み込み
  - `zeus_param()` でパラメータ取得
  - `readu()` でバイナリデータ読み込み
  - 時間平均処理（orbital period単位）
- 物理量の計算
  - 熱輻射圧（prad）とガス圧（pgas）
  - 表面密度（sigma）
  - フラックスと有効温度（teff）
  - ストレス（stress）

#### プロット機能（matplotlib実装）
- **S-curveプロット:** sigma vs teff
- **Alphaプロット:** pres vs stress（α=0.1, 0.01, 0.001の参照線付き）
- IDL版と同じ図のサイズ・比率を再現

### 4. 必要ファイル構造の文書化
各ターゲット（例: ws0433）で必要なファイル：
```
{target_name}/
├── h/
│   ├── resolv.data     # 時系列データ次元情報
│   └── vave.data       # ボリューム平均履歴データ
├── init/
│   └── iparax.data等   # omega, h0パラメータ
├── src/
│   └── Makefile        # PROBLEM タイプ判定
└── z3dinput            # シミュレーション入力パラメータ
```

### 5. TE_curves_all.py への名前変更と改善
- `s_curve_all.py` → `TE_curves_all.py` にリネーム
- 出力先を `./outputs/` に変更
- ファイル名を `TE_curves_all.pdf` に変更
- alphaプロットの線種を変更（実線、破線、点線）
- データパスを `target_config.py` で管理

### 6. GitHubリポジトリ準備
#### ファイル整理
- `obsolete/` ディレクトリ作成
- IDLファイル（*.pro）等を移動
- 必要最小限のPythonファイルのみ残す

#### .gitignore 作成
```
data/
outputs/
logs/
__pycache__/
*~
.DS_Store
```

#### README.md 作成
- プロジェクト概要（Thermal Equilibrium curves）
- 必要ファイルとデータ構造
- 使用方法
- 物理的背景の説明

### 7. GitHubへの公開
- リポジトリ初期化（git init）
- 初回コミット実施
- GitHub（nombac/TE_curves）へプッシュ完了

## 作成・更新ファイル一覧

### 新規作成
1. `CLAUDE.md` - Claude Code用ドキュメント
2. `README.md` - プロジェクト説明書
3. `.gitignore` - Git無視設定
4. `TE_curves_all.py` - メインスクリプト（s_curve_all.pyから改名）

### 更新
1. `target_config.py` - 全66ターゲット追加、DATA_BASE_PATH設定
2. `zeus_param.py` - 既存（変更なし）
3. `readu.py` - 既存（変更なし）

## 技術的詳細

### IDL → Python 変換のポイント
- 配列インデックス: IDL（1-based）→ Python（0-based）
- バイナリ読み込み: big-endian、float32形式
- プロット: Coyote Graphics → matplotlib
- 出力: PostScript → PDF

### 解決した問題
1. タプル/辞書のアクセスエラー → zeus_param()の戻り値を正しく処理
2. matplotlib legendエラー → LaTeXエスケープと存在チェック追加
3. スコープ問題 → 変数初期化とエラーハンドリング改善

## 成果物
- **GitHubリポジトリ:** https://github.com/nombac/TE_curves
- **動作確認済み機能:**
  - h2006, h2007の特別ケース処理
  - S-curveプロット生成
  - Alphaプロット生成（線種区別付き）

### 8. GitHubリポジトリの最終調整
#### CLAUDE.mdの非公開化
- CLAUDE.mdを.gitignoreに追加
- GitHubの追跡から削除（ローカルファイルは保持）
- `git rm --cached CLAUDE.md` で対応

#### README.md の修正
- 実行コマンドを `python3 TE_curves_all.py` に変更
- 出力先を `outputs/` ディレクトリに修正
- ファイル名を `TE_curves_all.pdf` に変更

#### TE_curves_all.py のコメント追加
- h2006の詳細コメント追加（DOI 10.1086/499153）
- h2007の詳細コメント追加（DOI 10.1086/519515）
- 各パラメータの物理的意味を日本語で説明
- αパラメータの値を論文に基づいて修正（h2006: 0.016, h2007: 0.03）

## 次回への申し送り
- 実際のシミュレーションデータ（/Volumes/Pegasus*/）が利用可能になれば全ターゲットの処理が可能
- `constants.py`と`zeus_utils.py`は今回未使用だが、将来の拡張用に残す検討が必要
- Citation、References、License情報の追加が必要